## I/O重定向和管道 —— 习题(部分)

##### 10.1 符号`>>`可以告诉`shell`将输出添加到文件末尾上。`shell`是使用自动添加模式，还是简单的寻找文件的结尾并从这里开始写数据？…

自动添加模式。



##### 10.2  在`pipe.c`中，父进程运行着消费数据的程序，子进程运行着产生数据的程序。如果这两个程序的角色交换，那么结果有何差别？将测试语句`if(pid>0)`换为`if(pid==0)`，角色就可以互换。这将会导致什么情况？为什么？

- 交换父进程和子进程后，父进程执行完`cmd1`，产生完数据就结束了；子进程接收到管道中的数据并且输入到`cmd2`处理，然后一直等待管道写入端被关闭…导致子进程被挂起。



##### 10.3 若需要`shell`支持管道，需要怎样做改动？首先，如何修改控制流来识别并处理以管道结尾的命令？其次，若有许多命令，它们之间通过管道符号来分割，那又该怎样的修改？

搜索cmd匹配管道符号，递归`fork`并进行管道通讯。



##### 10.4 在`pipe.c`中，读进程`sort`关闭了从父进程那里复制来的管道写数据端。修改代码让读进程不要关闭管道的写数据端。运行程序，并对结果作出解释。

父进程中没有关闭写入端，然后执行`sort`命令，没有接收到数据。接着子进程产生数据，然而父进程没再从管道读取数据，被阻塞了，程序没有输出。



##### 10.8 在`pipe.c`中，调用了`fork`和`exec`函数，但是并没有调用`wait`。这是为什么？

父进程先堵塞，等待子进程数据被写入管道，子进程写完关闭管道退出；父进程读取到数据并输出后也关闭退出程序。
有了管道，程序之间的通信不再需要`wait`，而父进程作为读取端也会等待子进程（写入端）执行完毕，再往下继续，也不需要`wait`。